# Only run in interactive shells
[[ $- == *i* ]] || return 0

term_exists() { infocmp "$1" &>/dev/null; }
if ! term_exists "$TERM"; then
    if term_exists "${TERM%-256color}"; then
        TERM="${TERM%-256color}"
    elif [[ "$TERM" =~ tmux.* ]] && term_exists tmux-256color; then
        TERM=tmux-256color
    elif [[ "$TERM" =~ tmux.* ]] && term_exists tmux; then
        TERM=tmux
    elif [[ "$TERM" =~ tmux.* ]] && term_exists screen-256color; then
        TERM=screen-256color
    elif [[ "$TERM" =~ tmux.* ]] && term_exists screen; then
        TERM=screen
    elif term_exists xterm-256color; then
        TERM=xterm-256color
    else
        TERM=xterm
    fi
    export TERM
fi

color-log() {
    sed -r \
        -e "s/(.*error.*)/$(tput setaf 1)\\1$(tput sgr0)/I" \
        -e "s/(.*warning.*)/$(tput setaf 3)\\1$(tput sgr0)/I" \
        -e "s/(.*debug.*)/$(tput setaf 7)\\1$(tput sgr0)/I"
}


set -o noclobber

shopt -s checkwinsize

# disable XON/XOFF flow control (^s/^q)
stty stop ''
stty -ixoff
stty -ixon

HISTCONTROL=ignorespace:ignoredups:erasedups
shopt -s histappend

if [[ -r "/usr/share/bash-completion/bash_completion" ]]; then
    . /usr/share/bash-completion/bash_completion
fi

export PAGER=less
export EDITOR=vi
export VISUAL=vi

PROMPT_DIRTRIM=2
PS1="\\[\\e[31m\\]\\u\\[\\e[m\\]@\\[\\e[33m\\]\\h\\[\\e[m\\]:\\[\\e[32m\\]\\w\\[\\e[m\\]\\n\\$ "
if [[ -f /var/run/reboot-required ]]; then
    PS1="\\[\\e[31m\\]R \\[\\e[m\\]${PS1}"
fi

eval "$(dircolors)"
alias ls='LC_COLLATE=POSIX ls  -F --color=auto --group-directories-first'
alias ll='LC_COLLATE=POSIX ls -lF --color=auto --group-directories-first'
alias l='LC_COLLATE=POSIX ls -lAF --color=auto --group-directories-first'
command -v vim &>/dev/null && alias vi=vim

SSHRCD="$SSHHOME/.sshrc.d"
export MYVIMRC="$SSHRCD/vimrc"
export VIMINIT="source $MYVIMRC"

export INPUTRC="$SSHRCD/inputrc"

export LESS='-iRX-P%f ?m(file %i/%m) .lines %lt-%lb?L/%L. ?e(END)?x - Next\: %x.:?PB%PB\%..%t'
export LESSHISTFILE=$SSHHOME/.lesshst
export LESSKEY=$SSHHOME/.less
lesskey "$SSHRCD/lesskey"

export LESS_TERMCAP_md=$(tput setaf 1; tput bold)
export LESS_TERMCAP_us=$(tput setaf 2; tput bold)
export LESS_TERMCAP_ue=$(tput sgr0)
export LESS_TERMCAP_so=$(tput setaf 0; tput setab 7)
export LESS_TERMCAP_se=$(tput sgr0)
export GROFF_NO_SGR=1

export CLIFF_FIT_WIDTH=1

eval "$(dircolors -b "$SSHRCD"/dircolors)" 2>/dev/null || :

echo -e "\\e]0;${HOSTNAME%%.*}\\e\\"

# vim: ft=sh
